<link href="../polymer/polymer.html" rel="import">
<link href="../paper-shadow/paper-shadow.html" rel="import">
<link rel="import" href="../ajax-form/ajax-form.html">
<link href="paper-dialog-base.html" rel="import">
<link href="paper-action-dialog.html" rel="import">
<link rel="import" href="../juicy-html/juicy-html.html">

<!-- <link rel="import" href="../google-map/google-map.html"> -->

<polymer-element name="session-action-dialog" extends="paper-dialog-base" role="dialog" layout vertical>

<template>

  <style>
  a {
    text-decoration: none;
    color: #5a7db2;
  }

  a:hover {
    text-decoration: underline;
  }
  :host {
    background: #fff;
    color: rgba(0, 0, 0, 0.87);
    margin: 52px;
    overflow: visible !important;
  }

  h1 {
    font-size: 1.5em;
    font-weight: 300;
  }

	h4 {
		color:#666;
		font-weight: 400;
	}

  #actions {
    padding: 16px;
  }

  #session-info-header {
  	margin-top:20px;
	}

	.info-content {
		font-size:0.8em;
	}

	.info-header {
		border-top:1px solid #d7d7d7;
	}

	.input-left {
		float:left;
		margin-right: 10px;
    max-width: 245px;
	}
	.input-right {
    padding-top: 1px;
		text-align: right;
	}
	.input-row {
		margin-top:10px;
	}

	.register_input {
		font-family: 'Lato', 'Helvetica Neue', Helvetica, Arial, Sans Serif;
		font-size:1em;
		width:200px;
		color: #555555;
		padding: 9px 8px 9px 8px;
	}

  .scroller {
    overflow: auto;
    box-sizing: border-box;
    padding: 24px 24px 0 24px;
    width: 525px;
    height: 635px;
    font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, Sans Serif;
  }

  </style>

  <paper-shadow z="3" fit></paper-shadow>

  <!-- need this because the host needs to be overflow: visible -->
  <div id="scroller" class="scroller" relative flex auto>
    <template if="{{heading}}">
      <h1>{{heading}}</h1>
    </template>

	<div id="session-info-header" class="info-header">
		<p><h4>Session Information</h4></p>
	</div>
	<div id="session-info-content" class="info-content">
		<p>
			<span id="detailed_session_type">{{classroom}}</span>
			<span id="detailed_start"><template is="juicy-html" content="{{ dates }}"></template></span> 
			<span id="start_end_time"><template is="juicy-html" content="{{ startendtime }}"></template></span></strong></p>

			<span id="detailed_description"><template is="juicy-html" content="{{ description }}"></template></span>

			<template is="juicy-html" content="{{ gmap }}"></template>

      <div class="input-row">
        <div class="input-left">
          <p>
            <template is="juicy-html" content="{{ location }}"></template>
            <span id="detailed_cost">{{cost}}</span> (plus applicable taxes)
          </p>
        </div>
        <div class="input-right">
          <p>
            <strong><span id="vendor_name">{{vendorname}}</span></strong><br />
            <template is="juicy-html" content="{{ vendorurl }}"></template>
            <template is="juicy-html" content="{{ vendoremail }}"></template>
            <template is="juicy-html" content="{{ vendorcontact }}"></template>
          </p>
        </div>
      </div>
      <div style="clear:both"></div>
			
	</div>
	<div class="info-header">
		<p><h4>Register</h4></p>
	</div>

	<form id="register_form" is="ajax-form" action="/register_session" method="post">
		<div id="rf_row1">
			<div class="input-left">
				<input type="text" id="first_name" name="first_name" placeholder="First Name" class="register_input" required>
			</div>
			<div>
				<input type="text" id="last_name" name="last_name" placeholder="Last Name" class="register_input" required>
			</div>
		</div>
		<div class="input-row">
			<div class="input-left">
				<input type="email" id="email" name="email" placeholder="E-mail Address" class="register_input" required>
			</div>
			<div>
				<input type="text" id="phone" name="phone" placeholder="Phone: 1-999-999-9999" class="register_input">
			</div>
		</div>
		<input type="hidden" id="session_id" name="session_id" value="{{sessionid}}">
		<input type="hidden" id="ip_address" name="ip_address" value="{{ipaddress}}">
		<input type="hidden" id="action_time" name="action_time" value="{{actiontime}}">
	</form>

    <content select=":not([affirmative]):not([dismissive])"></content>
  </div>

  <div id="confirmation_message" class="scroller" relative flex auto style="display:none;">
    <h1>Thank you for registering</h1>
    <p style='margin-top:40px;'>
      A confirmation e-mail has been sent to your mailbox. A member of Trainingful staff will be in contact with you shortly.
    </p>
  </div>

  <div id="actions" relative layout horizontal>
    <content select="[dismissive]"></content>
    <div flex></div>
    <content select="[affirmative]"></content>
    <div id="close_button" style="display:none;">
    	<paper-button dismissive on-tap="{{cancelForm}}">Close</paper-button>
    </div>
    <div id="register_buttons">
    	<paper-button dismissive on-tap="{{cancelForm}}">Cancel</paper-button>
    	<paper-button affirmative hover on-tap="{{submitForm}}">Register</paper-button>
    </div>
  </div>

</template>

<script>

  Polymer({
  	classroom: "",
  	dates: "",
  	startendtime: "",
  	cost: "",
  	description: "",
  	location: "",
  	vendorname: "",
  	vendorurl: "",
  	vendoremail: "",
  	vendorcontact: "",
  	sessionid: "",
  	ipaddress: "",
  	actiontime: Date.now(),
  	gmap: "",
    publish: {
      closeSelector: '[affirmative],[dismissive]'
    },
    submitForm: function() {
    	this.$.register_form.actiontime = Date.now();
      var firstNameDom = this.$.register_form.first_name;
      if (typeof firstNameDom === "undefined") {
        var firstNameDom = document.getElementById('first_name');
      }
      var lastNameDom = this.$.register_form.last_name;
      if (typeof lastNameDom === "undefined") {
        var lastNameDom = document.getElementById('last_name');
      }
      var emailDom = this.$.register_form.email;
      if (typeof emailDom === "undefined") {
        var emailDom = document.getElementById('email');
      }
      var phoneDom = this.$.register_form.phone;
      if (typeof phoneDom === "undefined") {
        var phoneDom = document.getElementById('phone');
      }
    	firstNameDom.style.border = "";
    	lastNameDom.style.border = "";
    	emailDom.style.border = "";
    	phoneDom.style.border = "";
    	if (firstNameDom.value == "") {
    		firstNameDom.focus();
    		firstNameDom.style.border = "2px solid #ff8484";
    	}
    	else if (lastNameDom.value == "") {
    		lastNameDom.focus();
    		lastNameDom.style.border = "2px solid #ff8484";
    	}
    	else if (/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(emailDom.value) == false) {
    		emailDom.focus();
    		emailDom.style.border = "2px solid #ff8484";
    	}
    	else if (phoneDom.value == "") {
    		phoneDom.focus();
    		phoneDom.style.border = "2px solid #ff8484";
    	}
    	else {
    		this.$.register_form.submit();
	        this.$.scroller.style.display = "none";
    	    this.$.confirmation_message.style.display = "";
    		this.$.register_buttons.style.display = "none";
    		this.$.close_button.style.display = "inline";
    	}
    },
    cancelForm: function() {
      //this.$.confirmation_message.style.display = "none";
      //this.$.scroller.style.display = "";
    	this.close();
    }
  });
</script>

</polymer-element>